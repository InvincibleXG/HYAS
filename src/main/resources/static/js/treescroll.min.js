$(document).ready(function(){
    //treeReady();
});

function treeReady()
{
	$(".close_menu").each(function(){
		$(this).siblings("ul").hide();
	});
	$(".ontree").each(function(){
		$(this).parents("ul").show();
		$(this).parents("ul").siblings().addClass("open_menu").removeClass("close_menu");
	});
	$(document).on("click",".close_menu span",function(){
		$(this).parent().addClass("open_menu").removeClass("close_menu");
		$(this).parent().siblings("ul").fadeIn();
		treewidth();
	});
	$(document).on("click",".open_menu span",function(){
		$(this).parent().parent().find(".open_menu").addClass("close_menu").removeClass("open_menu");
		$(this).parent().parent().find("ul").hide();
		treewidth();
	});
//	$(document).on("click",".tree a",function(){
//		$(".ontree").removeClass("ontree");
//		$(this).addClass("ontree");
//		console.log($(this).attr("title")); //会触发两次click
//	});
	$(".tree a").click(function(){
        $(".ontree").removeClass("ontree");
        $(this).addClass("ontree");
        $("#iguid").val($(this).attr("guid"));
        $("#iname").val($(this).text());
        $("#itype").val($(this).attr("type"));
        $("#ipguid").val($(this).attr("pguid"));
        $("#shortName").val($(this).attr("shortName"));
        $("#description").val($(this).attr("description"));

    })
	treewidth();
}
function treewidth(){
    var items=new Array;
    var parents=new Array;
    var text_num=0,parent_num=0;
    $(".tree a").each(function(){
        if($(this).is(":hidden")==false){
            items.push($(this).text().length);
            parents.push($(this).parents("ul").length);
        }
    });
    text_num=Math.max.apply(null, items);
    parent_num=Math.max.apply(null, parents);
    $(".tree").width('auto');
}
